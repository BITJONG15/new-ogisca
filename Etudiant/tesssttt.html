<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nouvelle Requête</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
  <div class="w-full max-w-5xl bg-white shadow-lg rounded-2xl p-8">
    <h1 class="text-2xl font-bold text-center text-blue-700 mb-6">Nouvelle Requête Étudiant</h1>
    
    <!-- Formulaire de création -->
    <form action="save_requete.php" method="POST" enctype="multipart/form-data" class="space-y-5 mb-10">
      
      <!-- Nom de l'étudiant -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Étudiant</label>
        <input type="text" name="etudiant_nom" value="<?php echo $etudiant['nom'].' '.$etudiant['prenom']; ?>" 
               readonly class="w-full border rounded-lg px-4 py-2 bg-gray-100">
      </div>

      <!-- Niveau -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Niveau</label>
        <input type="text" name="niveau_nom" value="<?php echo $etudiant['niveau_nom']; ?>" 
               readonly class="w-full border rounded-lg px-4 py-2 bg-gray-100">
      </div>

      <!-- Division -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Division</label>
        <input type="text" name="division_nom" value="<?php echo $etudiant['division_nom']; ?>" 
               readonly class="w-full border rounded-lg px-4 py-2 bg-gray-100">
      </div>
      
      <!-- Choix de l'EC -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Élément Constitutif (EC)</label>
        <select name="ID_EC" id="ID_EC" class="w-full border rounded-lg px-4 py-2" required>
          <option value="">-- Sélectionnez un EC --</option>
          <?php
          foreach ($ecs as $ec) {
              echo "<option value='{$ec['ID_EC']}'>{$ec['Nom_EC']}</option>";
          }
          ?>
        </select>
      </div>
      
      <!-- Modalité d'évaluation -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Modalité d'évaluation</label>
        <input type="text" name="modalite" id="modalite" readonly 
               class="w-full border rounded-lg px-4 py-2 bg-gray-100">
      </div>
      
      <!-- Professeur -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Enseignant</label>
        <input type="text" name="professeur" id="professeur" readonly 
               class="w-full border rounded-lg px-4 py-2 bg-gray-100">
      </div>
      
      <!-- Motif -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Motif de la requête</label>
        <input type="text" name="motif" required class="w-full border rounded-lg px-4 py-2">
      </div>
      
      <!-- Contenu -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Contenu</label>
        <textarea name="contenu" rows="4" required class="w-full border rounded-lg px-4 py-2"></textarea>
      </div>
      
      <!-- Pièce jointe -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Pièce jointe</label>
        <input type="file" name="piece_jointe" class="w-full border rounded-lg px-4 py-2">
      </div>
      
      <!-- Bouton -->
      <div class="flex justify-center">
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg shadow hover:bg-blue-700">
          Envoyer la requête
        </button>
      </div>
    </form>

    <!-- Tableau des requêtes envoyées -->
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Mes Requêtes</h2>
    <div class="overflow-x-auto">
      <table class="w-full border border-gray-300 rounded-lg overflow-hidden">
        <thead class="bg-blue-600 text-white">
          <tr>
            <th class="px-4 py-2 text-left">Date</th>
            <th class="px-4 py-2 text-left">Motif</th>
            <th class="px-4 py-2 text-left">Enseignant</th>
            <th class="px-4 py-2 text-left">Statut</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <?php if (!empty($mes_requetes)) { 
            foreach ($mes_requetes as $req) { ?>
              <tr>
                <td class="px-4 py-2"><?php echo date("d/m/Y", strtotime($req['date_envoi'])); ?></td>
                <td class="px-4 py-2"><?php echo htmlspecialchars($req['motif']); ?></td>
                <td class="px-4 py-2"><?php echo $req['professeur_nom']." ".$req['professeur_prenom']; ?></td>
                <td class="px-4 py-2">
                  <?php 
                    if ($req['statut'] == 'en_attente') {
                      echo "<span class='px-2 py-1 bg-yellow-100 text-yellow-700 rounded'>En attente</span>";
                    } elseif ($req['statut'] == 'acceptee') {
                      echo "<span class='px-2 py-1 bg-green-100 text-green-700 rounded'>Acceptée</span>";
                    } else {
                      echo "<span class='px-2 py-1 bg-red-100 text-red-700 rounded'>Rejetée</span>";
                    }
                  ?>
                </td>
              </tr>
          <?php } } else { ?>
            <tr>
              <td colspan="4" class="text-center text-gray-500 py-4">Aucune requête envoyée.</td>
            </tr>
          <?php } ?>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
